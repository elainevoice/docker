version: '3.8'
services:
    proxy:
        extends:
            file: docker-compose.base.yaml
            service: proxy
        container_name: proxy_frontend
        hostname: proxy_frontend
        restart: unless-stopped
        build: 
          context: ./frontend
          target: production_stage
        environment:
            - NODE_ENV=production
            - REACT_APP_API={$API_ENDPOINT:-/api}
        volumes:
            - ./configuration/nginx.conf:/etc/nginx/nginx.conf
        tty: true
        expose:
            - 80
        depends_on:
            - backend
    backend:
        extends:
            file: docker-compose.base.yaml
            service: backend
networks:
    backend: